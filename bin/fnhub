#!/usr/bin/env node
process.bin = process.title = 'fnhub';

console.log('    ____             __                   __   ________    ____    \n'+
    '   / __ )____ ______/ /______ _____  ____/ /  / ____/ /   /  _/    \n'+
    '  / __  / __ `/ ___/ //_/ __ `/ __ \\/ __  /  / /   / /    / /     \n'+
    ' / /_/ / /_/ / /__/ ,< / /_/ / / / / /_/ /  / /___/ /____/ /       \n'+
    '/_____/\\__,_/\\___/_/|_|\\__,_/_/ /_/\\__,_/   \\____/_____/___/  \n'+
    '                                                                   \n'+
    'version: ' + require('../package.json').version + '\n');


"use strict";
var colors      =     require('colors');
var options     =     require('minimist')(process.argv.slice(2));
var logger      =     require('../lib/logger');
var commands    =     require('../lib/commands');
var router = require('../plugins/router');
var command     =     process.argv[2];
var config    =     require('../lib/config');
var fnhub    =     require('../lib/fnhub');
var subCommand = null;
if (options._.length > 1) subCommand = options._[1];

var backand = require('@backand/nodejs-sdk');
backand.init(config.backand);

logger.debug.log(command, options);

if(!command) {
  logger.warn("You didn't specify any command");
}
else {
  // track here
  var func = commands.getCommand(command, subCommand);
  if (func){
      func(options, fnhub);
  }
  else {
    if (process.argv.length >= 4){ // possibly a plugin
      var moduleName = process.argv[2];
      var commandName = process.argv[3];
      options = require('minimist')(process.argv.slice(3));
      var plugin = router(moduleName);
      if (plugin){ // found plugin
          var func = plugin(commandName);
          if (func){ // found command
            func(options, fnhub);
          }
          else{ // plugin has no such command
            logger.warn(moduleName.blue + ' plugin has no '.yellow + commandName.blue + ' command. Run fnhub '.yellow + moduleName.blue + ' help'.yellow);
          }
      } 
      else {
        logger.warn("backand didn't recognize the ".yellow + command.blue + ' command. Run '.yellow + 'funhub help'.yellow + ' to see all available commands'.yellow)
      }     
    }
    else { // not enough options for plugin
      logger.warn("backand didn't recognize the ".yellow + command.blue + ' command. Run '.yellow + 'fnhub help'.yellow + ' to see all available commands'.yellow)
    }
  }
}
